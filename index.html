<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ohio Childcare Locator</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      height: 100vh;
      overflow: hidden;
    }
    #map { 
      height: 100%; 
      width: 100%; 
    }
    /* Top control bar */
    .control-bar {
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      max-width: 600px;
    }
    .control-bar h1 {
      font-size: 1.4rem;
      margin-bottom: 4px;
      color: #2c3e50;
    }
    .control-bar p {
      font-size: 0.9rem;
      color: #7f8c8d;
      margin-bottom: 8px;
    }
    /* Search & filters */
    .search-box {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .search-box input {
      flex: 1;
      min-width: 200px;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
    }
    .filter-buttons {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .filter-btn {
      padding: 6px 12px;
      border: 1px solid #999;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    .filter-btn:hover {
      background: #f0f0f0;
    }
    .filter-btn.active {
      border-color: #3498db;
      background: #ecf0f1;
      font-weight: bold;
    }
    .filter-btn.center.active { background: #fadbd8; border-color: #e6194B; }
    .filter-btn.home.active { background: #d5f5e3; border-color: #3cb44b; }
    .filter-btn.school.active { background: #fef9e7; border-color: #ffe119; }
    /* Stats footer */
    .stats-footer {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background: rgba(255,255,255,0.85);
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 0.85rem;
      color: #555;
      z-index: 1000;
    }
    /* Legend */
    .legend {
      padding: 8px;
      line-height: 18px;
      color: #555;
      background: rgba(255,255,255,0.85);
      border-radius: 4px;
    }
    .legend i {
      width: 14px;
      height: 14px;
      float: left;
      margin-right: 6px;
      opacity: 0.7;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="control-bar">
    <h1>Ohio Childcare Locator</h1>
    <p>Find licensed childcare centers, homes, and school-age programs</p>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Search by city, ZIP, or provider name..." />
      <div class="filter-buttons">
        <div class="filter-btn center active" data-type="Center">Center</div>
        <div class="filter-btn home active" data-type="Home">Home</div>
        <div class="filter-btn school active" data-type="School Age">School-Age</div>
      </div>
    </div>
  </div>
  <div class="stats-footer">
    Showing <span id="providerCount">0</span> licensed providers in Ohio â€¢ Data: U.S. HHS (Q4 2025)
  </div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // === CONFIG ===
    const MAP_CENTER = [40.0, -82.5];
    const MAP_ZOOM = 7;
    
    // === INIT MAP ===
    const map = L.map('map').setView(MAP_CENTER, MAP_ZOOM);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    
    // === STATE ===
    let allFeatures = [];
    let markersLayer = L.layerGroup().addTo(map);
    let activeFilters = new Set(['Center', 'Home', 'School Age']);
    
    // === LOAD DATA ===
    // Try to load from external GeoJSON file first, fallback to sample data
    fetch('data/ohio-childcare.geojson')
      .then(res => {
        if (res.ok) return res.json();
        throw new Error('GeoJSON not found');
      })
      .then(data => {
        allFeatures = data.features;
        renderMarkers();
      })
      .catch(() => {
        // Fallback to sample data if GeoJSON file doesn't exist
        console.log('Using sample data. Add data/ohio-childcare.geojson for full dataset.');
        const sampleData = {
          type: "FeatureCollection",
          features: [
            {
              type: "Feature",
              geometry: { type: "Point", coordinates: [-83.0007, 39.9612] },
              properties: {
                ProviderName: "Columbus Learning Center",
                Address: "123 Main St",
                City: "Columbus",
                ZIP: "43215",
                County: "Franklin",
                Phone: "(614) 555-1234",
                ProviderType: "Center",
                Capacity: "85"
              }
            },
            {
              type: "Feature",
              geometry: { type: "Point", coordinates: [-81.6944, 41.4993] },
              properties: {
                ProviderName: "Cleveland Family Childcare",
                Address: "456 Oak Ave",
                City: "Cleveland",
                ZIP: "44115",
                County: "Cuyahoga",
                Phone: "(216) 555-6789",
                ProviderType: "Home",
                Capacity: "6"
              }
            },
            {
              type: "Feature",
              geometry: { type: "Point", coordinates: [-84.5241, 39.1031] },
              properties: {
                ProviderName: "Cincinnati After-School Club",
                Address: "789 Elm St",
                City: "Cincinnati",
                ZIP: "45202",
                County: "Hamilton",
                Phone: "(513) 555-4321",
                ProviderType: "School Age",
                Capacity: "40"
              }
            }
          ]
        };
        allFeatures = sampleData.features;
        renderMarkers();
      });
    
    // === HELPER: Create marker style ===
    function getColor(type) {
      if (type === 'Center') return '#e6194B';
      if (type === 'Home') return '#3cb44b';
      if (type === 'School Age') return '#ffe119';
      return '#0000ff';
    }
    
    // === RENDER MARKERS ===
    function renderMarkers() {
      markersLayer.clearLayers();
      let count = 0;
      
      allFeatures.forEach(feature => {
        const props = feature.properties;
        const type = props.ProviderType;
        
        // Filtering
        if (!activeFilters.has(type)) return;
        
        // Search filtering
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        if (searchTerm) {
          const searchable = (props.ProviderName + ' ' + props.City + ' ' + props.ZIP).toLowerCase();
          if (!searchable.includes(searchTerm)) return;
        }
        
        const latlng = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
        const marker = L.circleMarker(latlng, {
          radius: 7,
          fillColor: getColor(type),
          color: '#000',
          weight: 1,
          opacity: 1,
          fillOpacity: 0.9
        });
        
        let popupContent = `<b>${props.ProviderName}</b><br/>` +
          `${props.Address}, ${props.City}, OH ${props.ZIP}<br/>` +
          `<small>Type: ${type} â€¢ Capacity: ${props.Capacity || 'N/A'}</small><br/>`;
        if (props.Phone) popupContent += `<a href="tel:${props.Phone.replace(/\D/g,'')}">ðŸ“ž ${props.Phone}</a>`;
        
        marker.bindPopup(popupContent);
        markersLayer.addLayer(marker);
        count++;
      });
      
      document.getElementById('providerCount').textContent = count.toLocaleString();
    }
    
    // === EVENT LISTENERS ===
    document.getElementById('searchInput').addEventListener('input', renderMarkers);
    
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const type = e.target.dataset.type;
        if (activeFilters.has(type)) {
          activeFilters.delete(type);
          e.target.classList.remove('active');
        } else {
          activeFilters.add(type);
          e.target.classList.add('active');
        }
        renderMarkers();
      });
    });
    
    // === LEGEND ===
    const legend = L.control({position: 'bottomright'});
    legend.onAdd = function () {
      const div = L.DomUtil.create('div', 'legend');
      div.innerHTML = `
        <div><i style="background:#e6194B"></i> Center</div>
        <div><i style="background:#3cb44b"></i> Home</div>
        <div><i style="background:#ffe119"></i> School-Age</div>
      `;
      return div;
    };
    legend.addTo(map);
  </script>
</body>
</html>

